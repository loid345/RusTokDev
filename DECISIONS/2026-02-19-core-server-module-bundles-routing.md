# Авто-регистрация HTTP routes и разделение `core-server` / `module-bundles`

- Date: 2026-02-19
- Status: Proposed

## Context

`apps/server/src/app.rs` содержит централизованную ручную сборку роутов по всем доменным модулям. При подключении нового модуля нужно править центральный серверный слой, что создаёт coupling и ухудшает масштабируемость модульной архитектуры.

В документе архитектурных улучшений этот пункт зафиксирован как стратегический (2.14), но без ADR реализация не должна стартовать.

## Decision

1. Ввести модульный HTTP-контракт (например, `HttpModule`) поверх `RusToKModule`, который отдаёт маршруты модуля.
2. Перевести `apps/server` в двухуровневую модель:
   - `core-server`: базовые системные маршруты и инфраструктура;
   - `module-bundles`: подключаемые HTTP-модули из registry.
3. Роуты optional-модулей подключать автоматически из registry/bundle-слоя без ручной правки центрального `app.rs`.
4. Ввести migration guardrails:
   - feature flag на поэтапный rollout;
   - parity-тесты на совпадение существующих роутов до/после миграции;
   - rollback-план на один релиз.

## Consequences

**Плюсы**
- Новый модуль можно добавить без изменения central routing glue.
- Чётче разделяются platform foundation и доменные расширения.
- Улучшается тестируемость и ownership границ.

**Риски и минусы**
- Потребуется миграция текущей route wiring и возможно пересборка bootstrap-последовательности.
- Усложняется startup orchestration на первом этапе внедрения.

**Follow-up**
- Подготовить technical design с примером контракта `HttpModule`.
- Добавить parity/integration тесты маршрутизации перед миграцией production конфигурации.
