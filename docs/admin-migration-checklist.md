# План реализации админки (Leptos-only, актуализированный)

Ниже — рабочий план с учетом текущих реалий:

- админка только на **Leptos**;
- библиотечная база уже собрана;
- недостающие кейсы закрываем через **наши самописные библиотеки** и донаполняем их по мере внедрения;
- **многоязычность (без фиксации на конкретной паре языков) включаем сразу**, а не "потом".

---

## 0) Принципы реализации

- **Backend-first вертикальными срезами**: каждый экран доводим до рабочего состояния с реальным API.
- **UI-шаблоны только как визуальный референс**: без переноса чужой логики.
- **No fake data в production-потоке**: только реальные данные и реальные permission checks.
- **i18n by default**: любой новый текст сразу через ключи локализации.
- **Library-first**: если не хватает компонента/хука — дополняем общий library-слой и переиспользуем.

---

## 1) Технический baseline (must-have до масштабирования)

- [x] Маршрутизация и базовый shell
- [x] Auth flow (login/register/reset)
- [x] Защита приватных маршрутов (auth guard)
- [x] Базовые экраны Dashboard/Profile/Users/Security
- [ ] Единый `AppLayout` (Sidebar/Header/Breadcrumbs) в финальном виде
- [ ] Единый слой типизированных клиентских ошибок и UI-обработки
- [ ] Общая схема feature flags для admin-экрана/модуля

---

## 2) P0 (критический функционал go-live)

### 2.1 RBAC и безопасность

- [ ] RBAC на уровне роутов/экранов
- [ ] RBAC на уровне действий (кнопки, bulk actions, dangerous ops)
- [ ] Проверки permission в API + консистентная обработка 403 в UI
- [ ] Аудит действий администратора: кто/что/когда/tenant/ip

### 2.2 Пользователи (операционный минимум)

- [ ] Users Create
- [ ] Users Update
- [ ] Users Disable/Enable
- [ ] Фильтры + пагинация + сортировка с URL state
- [ ] Карточка пользователя с историей ключевых действий

### 2.3 Системная наблюдаемость в админке (MVP)

- [ ] Статусы модулей (enabled/disabled)
- [ ] Event/Index pipeline status (MVP-индикаторы)
- [ ] Health/readiness summary для оператора

### 2.4 Многоязычность (сразу)

- [ ] Подключить i18n provider в корневой layout
- [ ] Вынести все текущие строки интерфейса в ключи
- [ ] Namespace-структура локализаций (auth, dashboard, users, security, common)
- [ ] Language switcher + сохранение выбора пользователя
- [ ] Проверка отсутствия hardcoded-строк в новых PR

---

## 3) P1 (после закрытия P0)

### 3.1 Расширенные операции с пользователями

- [ ] Bulk actions
- [ ] Экспорт пользователей
- [ ] Импорт пользователей

### 3.2 UX/шаблонная полировка

- [ ] Перенос визуального shell из шаблонного референса в Leptos-компоненты
- [ ] Унификация таблиц/форм/пагинации
- [ ] Доработка адаптивности и доступности (a11y)

### 3.3 Production-hardening

- [ ] Пустые/ошибочные/долгие состояния на всех ключевых экранах
- [ ] Единые confirm-dialog паттерны для опасных действий
- [ ] Набор smoke/e2e сценариев для admin critical path

---

## 4) План по спринтам (предложение старта)

### Sprint 1 — "Рабочее ядро админки"

- RBAC route/action checks
- Users Create/Update/Disable
- i18n foundation (provider, namespaces, switcher)
- Базовый аудит admin-действий

**Definition of Done (Sprint 1):**

- роль `admin` закрывает полный users-flow;
- роль без нужных прав получает корректный UX при 403;
- все новые и затронутые тексты локализованы минимум для базового набора поддерживаемых языков;
- критичные admin-действия пишутся в аудит.

### Sprint 2 — "Операционка и наблюдаемость"

- Module enable/disable controls (MVP)
- Event/Index status widgets
- Health/readiness summary
- UX-доработка shell и breadcrumbs

---

## 5) Политика развития самописных библиотек

Если библиотека не покрывает кейс:

1. Сначала фиксируем gap (что именно отсутствует).
2. Добавляем минимальный расширяемый API в библиотеку.
3. Сразу используем в админке как первый production-consumer.
4. Покрываем тестом/примером и документируем паттерн использования.

> В админке не плодим локальные одноразовые решения там, где нужен переиспользуемый примитив.

---

## 6) Критерий готовности к go-live

- [ ] Все P0-пункты закрыты
- [ ] P0-сценарии пройдены вручную по чеклисту
- [ ] Smoke/e2e критического пути стабильно зелёные
- [ ] Ревью безопасности (RBAC + audit) завершено
- [ ] Подготовлен go-live отчёт

> Админка считается готовой к релизу только после выполнения критериев этого раздела.
